# CLAUDE.md

This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.

## Repository Overview

This is a personal dotfiles repository for macOS configuration management. The repository uses a symlink-based deployment strategy to manage configuration files for various tools and applications.

## Deployment System

### Symlink Management (`link.sh`)

The core deployment mechanism is `link.sh`, which creates symlinks from this repository to the appropriate system locations:

```bash
./link.sh
```

**Key behaviors:**
- Creates parent directories if they don't exist
- Backs up existing files/directories to `.bak` before replacing
- Skips if correct symlink already exists
- Expands tilde (`~`) to `$HOME` in destination paths

**Managed configurations:**
- `.config/karabiner` → `~/.config/karabiner` (keyboard customization)
- `.config/wezterm` → `~/.config/wezterm` (terminal emulator)
- `.config/yabai` → `~/.config/yabai` (window manager)
- `.config/skhd` → `~/.config/skhd` (hotkey daemon)
- `.config/starship.toml` → `~/.config/starship.toml` (shell prompt)
- `.config/yazi` → `~/.config/yazi` (file manager)
- `.gitconfig` → `~/.gitconfig`
- `.hammerspoon/init.lua` → `~/.hammerspoon/init.lua` (macOS automation)
- `.claude/{agents,commands,skills,rules}` → `~/.claude/{agents,commands,skills,rules}` (Claude Code configuration)

## Architecture

### Window Management Stack

**Yabai + skhd + Hammerspoon** form a complete window management system:

- **Yabai** (`.config/yabai/yabairc`): Tiling window manager providing automatic window layout
- **skhd** (`.config/skhd/skhdrc`): Hotkey daemon binding keyboard shortcuts to yabai commands
- **Hammerspoon** (`.hammerspoon/init.lua`): Lua-based macOS automation with custom hotkeys

**skhd Key Bindings Pattern:**
- `alt + hjkl`: Focus windows (vim-style navigation)
- `shift + alt + hjkl`: Swap windows
- `ctrl + alt + hjkl`: Warp windows (move and split)
- `alt + wasd`: Focus displays
- `shift + alt + wasd`: Move window to display
- `shift + alt + 1-7`: Move window to space
- `shift + alt + m`: Toggle fullscreen
- `shift + alt + t`: Toggle float
- `shift + alt + e`: Balance windows

### Terminal Configuration (WezTerm)

**Structure:**
- `wezterm.lua`: Main config (theme, font, window settings)
- `keybinds.lua`: Separate keybinding configuration loaded via `require("keybinds")`

**Leader key:** `Ctrl+q` (1000ms timeout)

**Architecture pattern:** Config is split into main config and keybinds module for maintainability.

### Git Configuration

**Custom aliases in `.gitconfig`:**
- `delete-merged <branch>`: Delete local branches already merged into specified branch (excludes develop/main)
- `gmm`: Fetch and merge from origin/main
- `st/co/br/ci`: Standard abbreviations
- `unstage`: Unstage files
- `undo`: Undo last commit (keeps changes)

### Claude Code Integration

**Directory structure:**
- `.claude/agents/`: Custom agent definitions
- `.claude/commands/`: Custom commands
- `.claude/skills/`: Skill definitions
- `.claude/rules/`: Project-specific rules (already documented in this repo)

These are symlinked to `~/.claude/` to provide global Claude Code configuration across all projects.

## Testing Changes

After modifying configurations:

1. **WezTerm:** Config auto-reloads (or `Cmd+Shift+R` to force reload)
2. **Hammerspoon:** Auto-reloads on `.lua` file changes (shows "Config loaded" alert)
3. **skhd:** `brew services restart skhd` or `skhd --reload`
4. **Yabai:** `brew services restart yabai` or `yabai --restart-service`
5. **Karabiner:** Changes to `karabiner.json` auto-reload via Karabiner-Elements app
6. **Starship:** Starts new shell session
7. **Git:** Changes take effect immediately (global config)

## Critical Constraints

1. **Karabiner JSON:** The `karabiner.json` file is auto-generated by Karabiner-Elements GUI. Manual edits should be done through the application to avoid corruption.

2. **Backup behavior:** `link.sh` creates `.bak` backups. These may accumulate and should be manually cleaned if no longer needed.

3. **macOS-specific:** All window management tools (yabai, skhd, Hammerspoon, Karabiner) are macOS-only. WezTerm is cross-platform but config may contain macOS-specific settings (e.g., `macos_window_background_blur`).

4. **Service dependencies:** yabai and skhd run as system services via Homebrew. Changes require service restart, not just config reload.

## File Modification Guidelines

- **WezTerm keybinds:** Modify `keybinds.lua`, not `wezterm.lua`
- **Window manager hotkeys:** Edit `skhdrc` for keyboard shortcuts
- **Git aliases:** Add to `.gitconfig` `[alias]` section
- **Hammerspoon automation:** Edit `init.lua` for custom hotkeys/automation
- **Karabiner:** Use Karabiner-Elements GUI, not direct JSON editing

## Global vs Repository Configs

Files symlinked from this repository become **global configurations**. Changes here affect system-wide behavior. To test changes safely:

1. Modify files in this repository
2. Run `./link.sh` to update symlinks
3. Reload affected services/applications
4. Verify behavior
5. Commit if successful
